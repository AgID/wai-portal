window.AgidSpidEnter=function(){"use strict";function i(i,e){return A.tpl[i].call(A,e)}function e(i){i.removeAttribute("hidden")}function t(i){var e=document.createAttribute("hidden");i.setAttributeNode(e)}function n(i){var e=setInterval(function(){i.focus()},100);x.addEventListener("focus",function(){clearInterval(e)})}function a(){t(w),w.innerHTML="",n(x)}function o(t){w.innerHTML=i("infoModalContent",t),e(w),document.querySelector("#closemodalbutton").addEventListener("click",a)}function d(){for(var i=E.children.length;i>=0;i--)E.appendChild(E.children[Math.random()*i|0])}function r(i){var e=27===i.keyCode,t=!w.hasAttribute("hidden");e&&(t?a():l())}function s(){d(),e(I),n(x),document.addEventListener("keyup",r)}function l(){t(I),document.removeEventListener("keyup",r)}function c(){var e=document.querySelector("#agid-spid-enter"),t="";A.availableProviders.forEach(function(e){t+=i("spidProviderButton",e)}),e.innerHTML=i("spidProviderChoiceModal",t),document.querySelector("#agid-spid-panel-close-button").addEventListener("click",l),document.querySelector("#agid-cancel-access-button").addEventListener("click",l),document.querySelector("#nospid").addEventListener("click",function(){o(i("nonHaiSpid"))}),document.querySelector("#cosaspid").addEventListener("click",function(){o(i("cosaSpid"))})}function u(){var e=document.querySelectorAll(".agid-spid-enter-button"),t=Array.from(e),n=t.length;A.availableProviders?n?(t.forEach(function(e){var t=e.getAttribute("data-size"),n=t.toLowerCase(),a=["s","m","l","xl"];-1!==a.indexOf(n)?e.innerHTML=i("spidButton",n):console.error("Le dimenioni supportate sono",a,"trovato invece:",t,e)}),Array.from(document.querySelectorAll(".agid-spid-enter")).forEach(function(i){i.addEventListener("click",s)})):console.warn("Nessun placeholder HTML trovato nella pagina per i pulsanti SPID"):console.error("Si è verificato un errore nel caricamento dei providers, impossibile renderizzare i pulsanti SPID")}function p(i,e,t){return new Promise(function(n,a){var o=new XMLHttpRequest;o.open(i,e),o.onreadystatechange=function(){4===o.readyState&&(200===o.status&&o.responseText?n(JSON.parse(o.responseText)):a(o.responseText))}.bind(this),o.send(JSON.stringify(t))})}function g(){var i={language:A.language};return p("GET",A.config.localisationEndpoint,i)}function h(){return p("GET",A.config.providersEndpoint)}function v(i){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=i,document.head.appendChild(e)}function f(e){(I=document.createElement("section")).id=e,t(I),document.body.insertBefore(I,document.body.firstChild),I.innerHTML=i("spidMainContainers")}function m(){E=document.querySelector("#agid-spid-idp-list"),w=document.querySelector("#agid-infomodal"),x=document.querySelector("#agid-spid-panel-select")}function b(){document.getElementById("agid-spid-enter-container")||(v(A.config.stylesheetUrl),f("agid-spid-enter-container"))}function S(){b(),c(),u(),m()}function y(i,e){var t=[];i.forEach(function(i){i.isActive&&(i.payload=e?Object.assign({},e.common,e[i.provider]):{}),t.push(i)}),A.availableProviders=t}function P(i){A.language=i.language||A.language,A.formActionUrl=i.formActionUrl||A.formActionUrl,A.formSubmitMethod=i.formSubmitMethod||A.formSubmitMethod}var I,E,w,x,A=this;return A.availableProviders=null,{init:function(i){var e;return i&&P(i),e=[g(),h()],Promise.all(e).then(function(e){A.i18n=e[0],y(e[1].spidProviders,i&&i.providersPayload),S()}).catch(function(i){A.availableProviders=null,console.error("Si è verificato un errore nel caricamento dei dati",i)})},changeLanguage:function(i){return P({language:i}),g().then(function(i){A.i18n=i,S()}).catch(function(i){console.error("Si è verificato un errore nel caricamento dei dati",i)})},updateSpidButtons:u,version:function(){return A.config.version}}},window.AgidSpidEnter.prototype.tpl={spidMainContainers:function(){return['<div id="agid-spid-enter">',"</div>",'<div id="agid-infomodal" class="modal" aria-live="assertive" tabindex="0" hidden>',"</div>"].join("")},svgWithPngFallback:function(i,e){return['<img aria-hidden="true"','src="',this.config.assetsBaseUrl,i,'.svg"',"onerror=\"this.src='",this.config.assetsBaseUrl,i,".png'; this.onerror=null;\"",'alt="',e,'" />'].join("")},spidProviderChoiceModal:function(i){return['<div id="agid-spid-enter-anim"></div>','<section id="agid-spid-panel-select" aria-labelledby="agid-spid-enter-title-page" tabindex="0">','<header id="agid-spid-panel-header">','<nav class="agid-spid-panel-back agid-spid-panel-element" aria-controls="agid-spid-panel-select">','<button tabindex="0" id="agid-spid-panel-close-button" class="agid-spid-button agid-navigable" aria-labelledby="agid-cancel-access-button">',this.tpl.svgWithPngFallback.call(this,"img/x-icon",this.getI18n("naviga_indietro")),"</button>","</nav>",'<div class="agid-spid-panel-logo agid-spid-panel-element">',this.tpl.svgWithPngFallback.call(this,"img/spid-logo-c-lb",this.getI18n("alt_logo_SPID")),"</div>","</header>",'<div id="agid-spid-panel-content">','<div class="agid-spid-panel-content-center">','<div id ="agid-spid-enter-title-container">','<h1 id="agid-spid-enter-title-page" class="agid-font">',this.getI18n("scegli_provider_SPID"),"</h1>","</div>",'<div id="agid-spid-idp-list" class="agid-spid-row">',i,"</div>",'<div id="agid-cancel-access-container">','<button id="agid-cancel-access-button" class="agid-transparent-button agid-font agid-navigable">',"<span>",this.getI18n("annulla_accesso"),"</span>","</button>","</div>",'<div id="agid-logo-container" aria-hidden="true">',this.tpl.svgWithPngFallback.call(this,"img/agid-logo-bb-short"),"</div>","</div>","</div>",'<footer id="agid-spid-panel-footer">','<div id="agid-action-button-container">','<button id="nospid" class="agid-action-button agid-font agid-navigable">',"<span>",this.getI18n("non_hai_SPID"),"</span>","</button>",'<button id="cosaspid" class="agid-action-button agid-font agid-navigable">',"<span>",this.getI18n("cosa_SPID"),"</span>","</button>","</div>","</footer>","</section>"].join("")},hiddenField:function(i,e){return['<input type="hidden" name="',i,'" value="',e,'" />'].join("")},spidProviderButton:function(i){var e,t="provider",n="",a=i.isActive?this.getI18n("accedi_con_idp",i.title):this.getI18n("idp_disabled");if(i.payload){t=i.payload.providerHiddenName||t,delete i.payload.providerHiddenName,n+=this.tpl.hiddenField(t,i.provider);for(e in i.payload)n+=this.tpl.hiddenField(e,i.payload[e])}return['<span class="agid-spid-col l3 m6 s6 xs12">','<form id="agid-spid-provider-',i.provider,'"','action="',this.formActionUrl,'" method="',this.formSubmitMethod,'">','<button type="submit"','class="agid-spid-idp-button agid-spid-idp-',i.provider,'"','title="',a,'"','style="background-image: url(',this.config.assetsBaseUrl,"img/idp-logos/",i.logo,')"',i.isActive?"":"disabled",">","</button>",n,"</form>","</span>"].join("")},spidButton:function(i){return["\x3c!-- AGID - SPID BUTTON ",i.toUpperCase()," * begin * --\x3e",'<button class="agid-spid-enter agid-font agid-spid-enter-size-',i,'" hidden>','<span aria-hidden="true" class="agid-spid-enter-icon">',this.tpl.svgWithPngFallback.call(this,"img/spid-ico-circle-bb",this.getI18n("entra_con_SPID")),"</span>",'<span class="agid-spid-enter-text">',this.getI18n("entra_con_SPID"),"</span>","</button>","\x3c!-- AGID - SPID BUTTON ",i.toUpperCase()," * end * --\x3e"].join("")},infoModalContent:function(i){return['<div class="modal-content agid-font">','<button id="closemodalbutton"','class="close agid-navigable"','tabindex="0"','aria-label="',this.getI18n("aria_chiudi_modale"),'">','<b aria-hidden="true">&times;</b>',"</button>",'<div id="agid-infomodal-content" role="main" tabindex="0" aria-labelledby="agid-infomodal-title">',i,"</div>","</div>"].join("")},nonHaiSpid:function(){return['<div class="Prose">','<h2 class="u-text-h2 u-margin-bottom-xxs" id="agid-infomodal-title">Richiedi SPID</h2>',"<p>","Per richiedere e ottenere le tue credenziali SPID, il Sistema Pubblico di Identità Digitale, devi esser maggiorenne.","</p>",'<h3 class="u-text-h3">Di cosa hai bisogno</h3>',"<ul>","<li>un indirizzo e-mail</li>","<li>il numero di telefono del cellulare che usi normalmente</li>","<li>un documento di identità valido (uno tra: carta di identità, passaporto, patente, permesso di soggiorno)*</li>","<li>la tua tessera sanitaria con il codice fiscale*</li>","</ul>",'<p class="u-textSecondary"><small>',"* Durante la registrazione può esser necessario fotografarli e allegarli al form che compilerai.","</small></p>",'<p class="Prose">','<a role="button" class="Button Button--default Button--shadow Button--round u-text-r-xs" href="https://www.spid.gov.it/richiedi-spid" target="_blank">',"Richiedi SPID","</a>","</p>","</div>"].join("")},cosaSpid:function(){return['<div class="Prose">','<h2 class="u-text-h2 u-margin-bottom-xs" id="agid-infomodal-title">SPID</h2>','<p class="u-text-r-m u-lineHeight-l u-textSecondary">',"SPID, il Sistema Pubblico di Identità Digitale, è la soluzione che ti permette di accedere a tutti i servizi online della Pubblica Amministrazione con un'unica Identità Digitale (username e password) utilizzabile da computer, tablet e smartphone.","</p>",'<p class="Prose">','<a role="button" class="Button Button--default Button--shadow Button--round u-text-r-xs" href="https://www.spid.gov.it/richiedi-spid" target="_blank">',"Richiedi SPID","</a>","</p>","</div>"].join("")}},window.AgidSpidEnter.prototype.language="it",window.AgidSpidEnter.prototype.i18n={},window.AgidSpidEnter.prototype.getI18n=function(i,e){var t=this.language,n=this.i18n.language&&this.i18n.language[t]&&this.i18n.language[t][i],a=/\{\d}/;return e&&(n=n.replace(a,e)),n||console.error("La chiave richiesta non è disponibile nel locale selezionato:",t,i),n||i},window.AgidSpidEnter.prototype.config={version:"1.0.0",assetsBaseUrl:"/vendor/spid-auth/",stylesheetUrl:"/vendor/spid-auth/css/agid-spid-enter.min.1.0.0.css",providersEndpoint:"/spid/providers",localisationEndpoint:"/vendor/spid-auth/data/spidI18n.json"},window.agidSpidEnter=new window.AgidSpidEnter;